//
//  TerrainInfo.swift
//  Reexplore
//
//  Created by Toni Kaufmann on 04.09.20.
//  Copyright Â© 2020 n3xd software studios ag. All rights reserved.
//
import Foundation

class TerrainInfo
{
    fileprivate static var lookupTable: [String:UInt8]? = .none
    
    init()
    {
        if TerrainInfo.lookupTable == .none {
            initLookupTable()
        }
    }
    
    func lookup(forColor color: ImageHelpers.Color) -> String
    {
        let k = key(forColor: color)
        if let feature = TerrainInfo.lookupTable![k] {
            var props = ""
            if feature == 0 {
                props = "\(props) water "
            }
            if feature & 0b0000001 > 0 {
                props = "\(props) 1 "
            }
            if feature & 0b0000010 > 0 {
                props = "\(props) 2 "
            }
            if feature & 0b0000100 > 0 {
                props = "\(props) 3 "
            }
            if feature & 0b0001000 > 0 {
                props = "\(props) 4 "
            }
            if feature & 0b0010000 > 0 {
                props = "\(props) 5 "
            }
            if feature & 0b0100000 > 0 {
                props = "\(props) 6 "
            }
            if feature & 0b1000000 > 0 {
                props = "\(props) 7 "
            }
            return props
        }
        
        return "n/a: \(k)"
    }

    fileprivate func initLookupTable()
    {
        TerrainInfo.lookupTable = [:]
        for i in 0..<256 {
            let k = key(forIndex: i)
            TerrainInfo.lookupTable![k] = UInt8(i)
        }
    }
    
    fileprivate func key(forColor color: ImageHelpers.Color) -> String
    {
        return "\(color.red).\(color.green).\(color.blue)"
    }

    fileprivate func key(forIndex index: Int) -> String
    {
        let row = TerrainInfo.lookupTableValues[index]
        return "\(row[0]).\(row[1]).\(row[2])"
    }
    
    fileprivate static let lookupTableValues:[[UInt8]] = [
     [  8,   3,  10],
     [ 19,   7,  12],
     [ 14,   8,  17],
     [ 16,   6,  20],
     [ 21,   8,  13],
     [ 17,  15,  21],
     [ 18,  16,  22],
     [ 21,   9,  26],
     [ 31,  12,  15],
     [ 27,  10,  22],
     [ 24,   9,  29],
     [ 35,  14,  17],
     [ 21,  20,  26],
     [ 28,  19,  23],
     [ 25,  18,  31],
     [ 39,  16,  19],
     [ 41,  17,  18],
     [ 38,  15,  25],
     [ 36,  19,  26],
     [ 26,  25,  31],
     [ 28,  20,  34],
     [ 34,  14,  37],
     [ 39,  24,  26],
     [ 43,  18,  28],
     [ 34,  21,  37],
     [ 52,  22,  21],
     [ 48,  20,  28],
     [ 42,  26,  29],
     [ 36,  19,  43],
     [ 36,  26,  36],
     [ 31,  32,  36],
     [ 44,  19,  36],
     [ 54,  24,  23],
     [ 56,  23,  23],
     [ 56,  24,  23],
     [ 43,  19,  42],
     [ 36,  26,  44],
     [ 46,  27,  35],
     [ 43,  25,  41],
     [ 52,  28,  29],
     [ 40,  24,  49],
     [ 59,  25,  29],
     [ 54,  32,  31],
     [ 39,  37,  42],
     [ 49,  36,  37],
     [ 68,  29,  27],
     [ 53,  30,  43],
     [ 56,  32,  38],
     [ 52,  29,  54],
     [ 43,  42,  51],
     [ 54,  37,  45],
     [ 68,  30,  39],
     [ 51,  43,  44],
     [ 78,  34,  30],
     [ 62,  35,  46],
     [ 67,  36,  41],
     [ 59,  34,  53],
     [ 60,  42,  45],
     [ 45,  51,  53],
     [ 58,  26,  69],
     [ 65,  44,  50],
     [ 61,  33,  66],
     [ 68,  37,  55],
     [ 73,  37,  50],
     [ 66,  36,  59],
     [ 54,  54,  57],
     [ 88,  40,  37],
     [ 73,  48,  45],
     [ 75,  36,  58],
     [ 75,  44,  52],
     [ 64,  43,  67],
     [ 66,  36,  72],
     [ 71,  46,  57],
     [ 70,  38,  67],
     [ 69,  29,  78],
     [ 78,  41,  57],
     [ 73,  37,  68],
     [ 72,  53,  58],
     [ 83,  40,  60],
     [ 58,  59,  67],
     [ 93,  49,  42],
     [102,  45,  39],
     [ 72,  37,  78],
     [ 69,  45,  74],
     [ 84,  38,  67],
     [ 78,  43,  69],
     [ 81,  50,  59],
     [ 76,  41,  74],
     [ 83,  44,  64],
     [ 58,  67,  68],
     [ 83,  38,  75],
     [ 74,  57,  68],
     [108,  50,  42],
     [ 76,  39,  86],
     [ 85,  52,  66],
     [ 88,  46,  69],
     [102,  46,  55],
     [ 83,  35,  86],
     [ 84,  45,  77],
     [ 88,  46,  72],
     [ 83,  37,  91],
     [ 84,  60,  67],
     [ 85,  50,  76],
     [ 89,  52,  70],
     [ 84,  44,  84],
     [ 88,  38,  87],
     [119,  52,  42],
     [104,  54,  56],
     [ 69,  73,  73],
     [ 88,  39,  89],
     [ 82,  63,  72],
     [ 83,  44,  91],
     [ 89,  59,  70],
     [100,  46,  72],
     [ 76,  57,  86],
     [ 89,  47,  83],
     [ 92,  51,  77],
     [ 91,  41,  89],
     [ 92,  58,  76],
     [104,  55,  68],
     [ 71,  80,  78],
     [ 72,  75,  83],
     [119,  57,  54],
     [ 87,  70,  74],
     [ 94,  55,  82],
     [ 98,  51,  85],
     [ 88,  46, 101],
     [ 81,  80,  77],
     [132,  58,  50],
     [103,  45,  94],
     [106,  54,  84],
     [ 99,  60,  87],
     [102,  52,  92],
     [123,  65,  58],
     [ 89,  74,  84],
     [ 75,  86,  87],
     [103,  47,  98],
     [103,  73,  72],
     [120,  61,  69],
     [100,  53, 100],
     [102,  61,  90],
     [105,  54,  94],
     [110,  58,  85],
     [107,  52,  98],
     [ 99,  52, 108],
     [104,  62,  93],
     [122,  67,  70],
     [101,  58, 101],
     [101,  72,  88],
     [134,  67,  60],
     [ 88,  87,  88],
     [107,  82,  75],
     [ 99,  60, 106],
     [102,  46, 118],
     [111,  50, 106],
     [118,  61,  88],
     [109,  58, 102],
     [109,  58, 105],
     [ 90,  83, 101],
     [135,  69,  70],
     [108,  66, 101],
     [121,  82,  72],
     [124,  65,  86],
     [102,  86,  90],
     [113,  57, 108],
     [106,  56, 117],
     [ 88,  97,  95],
     [129,  60,  95],
     [113,  66, 106],
     [117,  54, 114],
     [117,  60, 113],
     [135,  70,  87],
     [120,  55, 118],
     [134,  83,  76],
     [106,  68, 120],
     [106,  88, 101],
     [119,  90,  86],
     [148,  74,  73],
     [115,  60, 123],
     [120,  61, 117],
     [ 90, 105, 104],
     [119,  68, 114],
     [123,  55, 124],
     [111,  98,  95],
     [115,  67, 124],
     [117,  59, 130],
     [117,  76, 114],
     [148,  82,  77],
     [114,  90, 104],
     [123,  63, 122],
     [103, 103, 103],
     [122,  69, 118],
     [136,  71, 102],
     [108,  86, 117],
     [113,  78, 120],
     [135,  90,  86],
     [122,  73, 118],
     [149,  76,  88],
     [126,  65, 125],
     [123,  67, 131],
     [152,  85,  84],
     [125,  74, 123],
     [101, 113, 109],
     [139,  81, 103],
     [129,  70, 125],
     [105, 103, 117],
     [117, 100, 108],
     [131,  61, 133],
     [121,  87, 120],
     [149,  75, 104],
     [140, 100,  92],
     [132,  70, 134],
     [161,  83,  94],
     [155,  81, 104],
     [118, 113, 110],
     [129,  87, 125],
     [104, 121, 118],
     [122, 103, 118],
     [150,  78, 119],
     [135,  85, 136],
     [154,  84, 120],
     [164, 102,  92],
     [145,  73, 141],
     [164,  84, 111],
     [119, 121, 120],
     [141,  73, 146],
     [120, 112, 132],
     [135, 113, 118],
     [141,  83, 145],
     [154,  83, 133],
     [117, 130, 125],
     [136, 104, 135],
     [146,  76, 154],
     [147,  85, 152],
     [122, 132, 131],
     [150, 109, 129],
     [141, 105, 145],
     [137, 119, 136],
     [170,  91, 136],
     [145, 131, 124],
     [165, 116, 120],
     [147, 105, 150],
     [138, 120, 147],
     [146, 121, 143],
     [148, 119, 151],
     [173, 110, 138],
     [144, 138, 145],
     [156, 117, 162],
     [162, 123, 169],
     [157, 140, 162],
     [172, 148, 141],
     [165, 147, 171],
     [181, 160, 147],
     [172, 160, 180],
     [181, 152, 192],
     [198, 162, 173]]
}
